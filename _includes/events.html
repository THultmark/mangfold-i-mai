{% comment %} Feel free to re-write this in a sensible manner!{% endcomment %}

{% assign number-of-events = 0 %}
{% assign events = site.events | sort: 'event-date' %}
{% for event in events %}
{% assign event-date = event.event-date | date: "%d" %}
{% if include.date == event-date %}
{% assign number-of-events = number-of-events | plus:1 %}
{% assign event-weekday = event.event-date | date: "%A" %}
{% endif %}
{% endfor %}

{% if number-of-events > 0 %}

<section>

    {% assign dates = site.dates %}
    {% for day in dates %}
    {% assign day-date = day.event-date | date: "%d" %}
    {% if day-date == include.date %}
        <div class="day-header">
            <h3 class="date">
                <a href="{{ day.url  | relative_url }}">
                    <span>
                        <span class="day-number">
                            {{ day.event-date | date: "%-d" }}.
                        </span>
                        <span class="weekday">
                            {% include localized-weekday.html weekday=event-weekday %}
                        </span>
                    </span>
                </a>
            </h3>

            {% if day.theme %}
                <span class="theme">{{ day.theme }}</span>
            {% endif %}
        </div>
    {% endif %}
    {% endfor %}

    <ul class="schedule">
        {% for event in events %}
        {% assign event-date = event.event-date | date: "%d" %}
        {% if include.date == event-date %}

        <li class="{{event.privacy}} {{event.location-type}}">
            {% assign hour = event.event-date | date: "%H" %}
            {% if hour == "00" %}
            <div>
                {% if event.layout %}
                <a href="{{ event.url  | relative_url }}">
                    {{ event.title }}
                </a>
                {% else %}
                {{ event.title }}
                {% endif %}
            </div>
            {% else %}
                <span class="time">
                    <time>{{ event.event-date | date: "%k"}}:{{ event.event-date | date: "%M"}}</time> -
                    <time>{{ event.event-date-end | date: "%k"}}:{{ event.event-date-end | date: "%M"}}</time>
                </span>

                <a class="title" href="{{ event.url  | relative_url }}">
                   {{ event.title }}
                </a>
            {% endif %}

        </li>

        {% endif %}
        {% endfor %}

    </ul>
</section>


{% endif %}